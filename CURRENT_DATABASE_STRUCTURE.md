| md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| # Database schema

Source: `remote_schema.sql` exported from Supabase/Postgres.

## Summary

- Schemas documented: **1** (mostly `public`)

- Tables: **36**

- Enum types: **9**

- SQL functions: **25**

- Foreign keys: **69**

## Enum types

### `public.content_status`

`draft`, `published`

### `public.enrollment_role`

`instructor`, `ta`, `student`

### `public.file_type`

`storage`, `youtube`, `external_link`, `placeholder`

### `public.group_grading_mode`

`per_group`, `individual`

### `public.invite_status`

`pending`, `accepted`, `expired`

### `public.module_item_type`

`assignment`, `quiz`, `file`, `external_link`

### `public.notification_type`

`grade_released`, `assignment_due`, `announcement`, `submission_received`, `quiz_available`, `invite`, `message_received`, `group_created`, `due_date_reminder`

### `public.org_member_role`

`member`, `admin`, `superadmin`

### `public.question_type`

`mc_single`, `mc_multi`, `essay`, `matching`, `ordering`


## Functions

- `public.accept_pending_org_invites()`
- `public.delete_course_for_org_superadmin("p_course_id" "uuid")`
- `public.get_conversation_course_id("p_conv_id" "uuid")`
- `public.get_course_recipients("p_course_id" "uuid")`
- `public.get_org_feature_flags("p_org_id" "uuid")`
- `public.get_peer_user_ids()`
- `public.get_superadmin_course_ids()`
- `public.get_superadmin_org_ids()`
- `public.handle_new_user()`
- `public.has_pending_course_invite("p_course_id" "uuid")`
- `public.is_conversation_participant("p_conversation_id" "uuid")`
- `public.is_course_creator("p_course_id" "uuid")`
- `public.is_course_instructor("p_course_id" "uuid")`
- `public.is_enrolled_in_course("p_course_id" "uuid")`
- `public.is_instructor_for_group("p_group_id" "uuid")`
- `public.is_instructor_in_course("p_course_id" "uuid")`
- `public.is_org_admin_or_higher("p_org_id" "uuid")`
- `public.is_org_superadmin("p_org_id" "uuid")`
- `public.notify_course_students("p_course_id" "uuid", "p_type" "notification_type", "p_title" "text", "p_body" "text", "p_link" "text", "p_ref_id" "uuid")`
- `public.process_pending_invites()`
- `public.send_direct_message("p_course_id" "uuid", "p_recipient_id" "uuid", "p_subject" "text", "p_content" "text")`
- `public.shares_course_with("p_other_user_id" "uuid")`
- `public.sync_profile_name()`
- `public.update_updated_at()`
- `public.user_is_enrolled_in_course("p_user_id" "uuid", "p_course_id" "uuid")`

## Tables

### `public.admin_audit_log`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|org_id|"uuid"|NO|| |
|actor_user_id|"uuid"|NO|| |
|action|"text"|NO|| |
|target_type|"text"|YES|| |
|target_id|"uuid"|YES|| |
|details|"jsonb"|YES|| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "actor_user_id"  public.profiles("id")  (constraint `admin_audit_log_actor_user_id_fkey`)
- "org_id"  public.orgs("id")  (constraint `admin_audit_log_org_id_fkey`)

**Policies (RLS):**

- **audit_log: admins can insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (is_org_admin_or_higher(org_id))
- **audit_log: superadmin can view** [SELECT] roles=(public) PERMISSIVE USING (is_org_superadmin(org_id))


### `public.announcements`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|title|"text"|NO|| |
|content|"text"|YES|| |
|pinned|"boolean"|YES|false| |
|author_id|"uuid"|YES|| |
|created_at|"timestamp with time zone"|YES|now()| |
|updated_at|"timestamp with time zone"|YES|now()| |
|hidden|"boolean"|YES|false| |

**Foreign keys (outgoing):**

- "author_id"  public.profiles("id")  (constraint `announcements_author_id_fkey`)
- "course_id"  public.courses("id")  (constraint `announcements_course_id_fkey`)

**Policies (RLS):**

- **Enrolled see announcements** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = announcements.course_id) AND (enrollments.user_id = auth.uid())))))
- **Staff manage announcements** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = announcements.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.assignment_overrides`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|assignment_id|"uuid"|NO|| |
|user_id|"uuid"|NO|| |
|due_date|"timestamp with time zone"|YES|| |
|created_at|"timestamp with time zone"|NO|now()| |
|available_from|"timestamp with time zone"|YES|| |
|available_until|"timestamp with time zone"|YES|| |
|time_limit|"integer"|YES|| |
|submission_attempts|"integer"|YES|| |

**Foreign keys (outgoing):**

- "assignment_id"  public.assignments("id")  (constraint `assignment_overrides_assignment_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `assignment_overrides_user_id_fkey`)

**Policies (RLS):**

- **overrides_all** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (assignments a
     JOIN enrollments e ON (((e.course_id = a.course_id) AND (e.user_id = auth.uid()))))
  WHERE ((a.id = assignment_overrides.assignment_id) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **overrides_select** [SELECT] roles=(public) PERMISSIVE USING (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM (assignments a
     JOIN enrollments e ON (((e.course_id = a.course_id) AND (e.user_id = auth.uid()))))
  WHERE ((a.id = assignment_overrides.assignment_id) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))


### `public.assignments`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|title|"text"|NO|| |
|description|"text"|YES|| |
|points|"integer"|YES|100| |
|status|content_status|YES|'draft'::content_status| |
|due_date|"timestamp with time zone"|YES|| |
|allow_late_submissions|"boolean"|YES|true| |
|late_deduction|"integer"|YES|10| |
|allow_resubmission|"boolean"|YES|true| |
|category|"text"|YES|'homework'::text| |
|created_by|"uuid"|YES|| |
|created_at|"timestamp with time zone"|YES|now()| |
|updated_at|"timestamp with time zone"|YES|now()| |
|available_from|"timestamp with time zone"|YES|| |
|available_until|"timestamp with time zone"|YES|| |
|hidden|"boolean"|YES|false| |
|assignment_type|"text"|YES|'essay'::text| |
|grading_type|"text"|YES|'points'::text| |
|submission_modalities|"jsonb"|YES|'["text"]'::jsonb| |
|allowed_file_types|"jsonb"|YES|'[]'::jsonb| |
|max_file_size_mb|"integer"|YES|50| |
|question_bank_id|"uuid"|YES|| |
|submission_attempts|"integer"|YES|| |
|time_limit|"integer"|YES|| |
|randomize_questions|"boolean"|YES|false| |
|visible_to_students|"boolean"|YES|true| |
|show_stats_to_students|"boolean"|YES|false| |
|late_penalty_type|"text"|NO|'per_day'::text| |
|grading_notes|"text"|YES|| |
|num_questions|"integer"|YES|| |
|is_extra_credit|"boolean"|YES|false| |
|is_group_assignment|"boolean"|YES|false| |
|group_set_id|"uuid"|YES|| |
|group_grading_mode|"text"|YES|'per_group'::text| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `assignments_course_id_fkey`)
- "created_by"  public.profiles("id")  (constraint `assignments_created_by_fkey`)
- "group_set_id"  public.group_sets("id")  (constraint `assignments_group_set_id_fkey`)
- "question_bank_id"  public.question_banks("id")  (constraint `assignments_question_bank_id_fkey`)

**Policies (RLS):**

- **Enrolled see published assignments** [SELECT] roles=(public) PERMISSIVE USING ((((status = 'published'::content_status) AND (EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = assignments.course_id) AND (enrollments.user_id = auth.uid()))))) OR (EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = assignments.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))
- **Staff manage assignments** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = assignments.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.calendar_events`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|NO|| |
|title|"text"|NO|| |
|event_date|"timestamp with time zone"|NO|| |
|event_type|"text"|NO|'Event'::text| |
|description|"text"|YES|| |
|created_by|"uuid"|YES|| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `calendar_events_course_id_fkey`)
- "created_by"  auth.users("id")  (constraint `calendar_events_created_by_fkey`)

**Policies (RLS):**

- **calendar_events: delete staff** [DELETE] roles=(public) PERMISSIVE USING (((created_by = auth.uid()) OR is_course_instructor(course_id) OR is_course_creator(course_id) OR is_org_superadmin(( SELECT courses.org_id
   FROM courses
  WHERE (courses.id = calendar_events.course_id)
 LIMIT 1))))
- **calendar_events: insert staff** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((is_course_instructor(course_id) OR is_course_creator(course_id) OR is_org_superadmin(( SELECT courses.org_id
   FROM courses
  WHERE (courses.id = calendar_events.course_id)
 LIMIT 1))))
- **calendar_events: select enrolled** [SELECT] roles=(public) PERMISSIVE USING ((is_enrolled_in_course(course_id) OR is_org_superadmin(( SELECT courses.org_id
   FROM courses
  WHERE (courses.id = calendar_events.course_id)
 LIMIT 1))))


### `public.conversation_participants`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|conversation_id|"uuid"|NO|| |
|user_id|"uuid"|NO|| |
|last_read_at|"timestamp with time zone"|YES|| |

**Foreign keys (outgoing):**

- "conversation_id"  public.conversations("id")  (constraint `conversation_participants_conversation_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `conversation_participants_user_id_fkey`)

**Policies (RLS):**

- **convo_participants: enrolled insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (is_enrolled_in_course(get_conversation_course_id(conversation_id)))
- **convo_participants: own update** [UPDATE] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))
- **convo_participants: participant select** [SELECT] roles=(public) PERMISSIVE USING (is_conversation_participant(conversation_id))


### `public.conversations`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|NO|| |
|subject|"text"|YES|| |
|created_by|"uuid"|NO|| |
|created_at|"timestamp with time zone"|NO|now()| |
|updated_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `conversations_course_id_fkey`)
- "created_by"  public.profiles("id")  (constraint `conversations_created_by_fkey`)

**Policies (RLS):**

- **conversations: enrolled insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (((created_by = auth.uid()) AND is_enrolled_in_course(course_id)))
- **conversations: participant select** [SELECT] roles=(public) PERMISSIVE USING (((created_by = auth.uid()) OR is_conversation_participant(id)))
- **conversations: update** [UPDATE] roles=(public) PERMISSIVE USING (((created_by = auth.uid()) OR (EXISTS ( SELECT 1
   FROM enrollments e
  WHERE ((e.course_id = conversations.course_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))


### `public.course_groups`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|group_set_id|"uuid"|NO|| |
|course_id|"uuid"|NO|| |
|name|"text"|NO|| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `course_groups_course_id_fkey`)
- "group_set_id"  public.group_sets("id")  (constraint `course_groups_group_set_id_fkey`)

**Policies (RLS):**

- **course_groups: enrolled select** [SELECT] roles=(public) PERMISSIVE USING (is_enrolled_in_course(course_id))
- **course_groups: staff manage** [ALL] roles=(public) PERMISSIVE USING (is_instructor_in_course(course_id))


### `public.courses`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|name|"text"|NO|| |
|code|"text"|YES|| |
|description|"text"|YES|| |
|invite_code|"text"|YES|| |
|created_by|"uuid"|YES|| |
|start_here_title|"text"|YES|'Start Here'::text| |
|start_here_content|"text"|YES|| |
|active|"boolean"|YES|true| |
|created_at|"timestamp with time zone"|YES|now()| |
|updated_at|"timestamp with time zone"|YES|now()| |
|start_here_links|"jsonb"|YES|'[]'::jsonb| |
|oneroster_status|"text"|NO|'active'::text| |
|date_last_modified|"timestamp with time zone"|NO|now()| |
|org_id|"uuid"|YES|| |
|term|"text"|YES|'SPRING 2026'::text| |
|department_id|"uuid"|YES|| |

**Foreign keys (outgoing):**

- "created_by"  public.profiles("id")  (constraint `courses_created_by_fkey`)
- "department_id"  public.orgs("id")  (constraint `courses_department_id_fkey`)
- "org_id"  public.orgs("id")  (constraint `courses_org_id_fkey`)

**Policies (RLS):**

- **courses: delete** [DELETE] roles=(public) PERMISSIVE USING (((created_by = auth.uid()) OR is_instructor_in_course(id) OR ((org_id IS NOT NULL) AND is_org_superadmin(org_id))))
- **courses: insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (((created_by = auth.uid()) OR ((org_id IS NOT NULL) AND is_org_superadmin(org_id))))
- **courses: select** [SELECT] roles=(public) PERMISSIVE USING (((created_by = auth.uid()) OR is_enrolled_in_course(id) OR ((org_id IS NOT NULL) AND is_org_superadmin(org_id))))
- **courses: update** [UPDATE] roles=(public) PERMISSIVE USING (((created_by = auth.uid()) OR is_instructor_in_course(id) OR ((org_id IS NOT NULL) AND is_org_superadmin(org_id)))) WITH CHECK (((created_by = auth.uid()) OR is_instructor_in_course(id) OR ((org_id IS NOT NULL) AND is_org_superadmin(org_id))))


### `public.discussion_replies`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|thread_id|"uuid"|NO|| |
|content|"text"|NO|| |
|author_id|"uuid"|NO|| |
|is_ai|"boolean"|NO|false| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "author_id"  public.profiles("id")  (constraint `discussion_replies_author_id_fkey`)
- "thread_id"  public.discussion_threads("id")  (constraint `discussion_replies_thread_id_fkey`)

**Policies (RLS):**

- **replies_delete** [DELETE] roles=(public) PERMISSIVE USING (((author_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM (discussion_threads dt
     JOIN enrollments e ON (((e.course_id = dt.course_id) AND (e.user_id = auth.uid()))))
  WHERE ((dt.id = discussion_replies.thread_id) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))
- **replies_insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (((author_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM (discussion_threads dt
     JOIN enrollments e ON (((e.course_id = dt.course_id) AND (e.user_id = auth.uid()))))
  WHERE (dt.id = discussion_replies.thread_id)))))
- **replies_select** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (discussion_threads dt
     JOIN enrollments e ON (((e.course_id = dt.course_id) AND (e.user_id = auth.uid()))))
  WHERE ((dt.id = discussion_replies.thread_id) AND ((dt.hidden = false) OR (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))


### `public.discussion_threads`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|NO|| |
|title|"text"|NO|| |
|content|"text"|YES|| |
|author_id|"uuid"|NO|| |
|pinned|"boolean"|NO|false| |
|hidden|"boolean"|NO|false| |
|created_at|"timestamp with time zone"|NO|now()| |
|group_id|"uuid"|YES|| |

**Foreign keys (outgoing):**

- "author_id"  public.profiles("id")  (constraint `discussion_threads_author_id_fkey`)
- "course_id"  public.courses("id")  (constraint `discussion_threads_course_id_fkey`)
- "group_id"  public.course_groups("id")  (constraint `discussion_threads_group_id_fkey`)

**Policies (RLS):**

- **threads_delete** [DELETE] roles=(public) PERMISSIVE USING (((author_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM enrollments e
  WHERE ((e.course_id = discussion_threads.course_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))
- **threads_insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (((author_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM enrollments e
  WHERE ((e.course_id = discussion_threads.course_id) AND (e.user_id = auth.uid()))))))
- **threads_select** [SELECT] roles=(public) PERMISSIVE USING (((hidden = false) OR (EXISTS ( SELECT 1
   FROM enrollments e
  WHERE ((e.course_id = discussion_threads.course_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))
- **threads_update** [UPDATE] roles=(public) PERMISSIVE USING (((author_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM enrollments e
  WHERE ((e.course_id = discussion_threads.course_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))


### `public.enrollments`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|user_id|"uuid"|YES|| |
|course_id|"uuid"|YES|| |
|role|enrollment_role|NO|'student'::enrollment_role| |
|enrolled_at|"timestamp with time zone"|YES|now()| |
|oneroster_status|"text"|NO|'active'::text| |
|date_last_modified|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `enrollments_course_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `enrollments_user_id_fkey`)

**Policies (RLS):**

- **enrollments: delete** [DELETE] roles=(public) PERMISSIVE USING ((is_course_creator(course_id) OR is_course_instructor(course_id) OR (course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids))))
- **enrollments: insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((is_course_creator(course_id) OR is_course_instructor(course_id) OR (course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids)) OR ((user_id = auth.uid()) AND has_pending_course_invite(course_id))))
- **enrollments: select** [SELECT] roles=(public) PERMISSIVE USING (((user_id = auth.uid()) OR is_course_creator(course_id) OR is_course_instructor(course_id) OR (course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids))))
- **enrollments: update** [UPDATE] roles=(public) PERMISSIVE USING ((is_course_creator(course_id) OR is_course_instructor(course_id) OR (course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids)))) WITH CHECK ((is_course_creator(course_id) OR is_course_instructor(course_id) OR (course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids))))


### `public.files`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|name|"text"|NO|| |
|mime_type|"text"|YES|| |
|size_bytes|"integer"|YES|| |
|storage_path|"text"|NO|| |
|uploaded_by|"uuid"|YES|| |
|uploaded_at|"timestamp with time zone"|YES|now()| |
|hidden|"boolean"|YES|false| |
|external_url|"text"|YES|| |
|description|"text"|YES|| |
|is_placeholder|"boolean"|YES|false| |
|is_youtube|"boolean"|YES|false| |
|type|file_type|NO|'storage'::file_type| |
|folder|"text"|YES|| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `files_course_id_fkey`)
- "uploaded_by"  public.profiles("id")  (constraint `files_uploaded_by_fkey`)

**Policies (RLS):**

- **Enrolled see files** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = files.course_id) AND (enrollments.user_id = auth.uid())))))
- **Staff manage files** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = files.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.grade_categories`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|name|"text"|NO|| |
|weight|numeric(5,4)|YES|0| |
|drop_lowest|"integer"|YES|0| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `grade_categories_course_id_fkey`)

**Policies (RLS):**

- **Enrolled see grade categories** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = grade_categories.course_id) AND (enrollments.user_id = auth.uid())))))
- **Staff manage grade categories** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = grade_categories.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.grade_settings`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|NO|| |
|a_min|"numeric"|NO|90| |
|b_min|"numeric"|NO|80| |
|c_min|"numeric"|NO|70| |
|d_min|"numeric"|NO|60| |
|curve|"numeric"|NO|0| |
|extra_credit_enabled|"boolean"|NO|false| |
|created_at|"timestamp with time zone"|NO|now()| |
|grade_scale|"text"|YES|'letter'::text| |
|pass_min|"numeric"|YES|60| |
|hp_min|"numeric"|YES|80| |
|hp_pass_min|"numeric"|YES|60| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `grade_settings_course_id_fkey`)

**Policies (RLS):**

- **grade_settings_all** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments e
  WHERE ((e.course_id = grade_settings.course_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **grade_settings_select** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments e
  WHERE ((e.course_id = grade_settings.course_id) AND (e.user_id = auth.uid())))))


### `public.grades`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|submission_id|"uuid"|YES|| |
|score|numeric(5,2)|YES|| |
|feedback|"text"|YES|| |
|released|"boolean"|YES|false| |
|graded_by|"uuid"|YES|| |
|graded_at|"timestamp with time zone"|YES|now()| |
|updated_at|"timestamp with time zone"|NO|now()| |
|excused|"boolean"|YES|false| |

**Foreign keys (outgoing):**

- "graded_by"  public.profiles("id")  (constraint `grades_graded_by_fkey`)
- "submission_id"  public.submissions("id")  (constraint `grades_submission_id_fkey`)

**Policies (RLS):**

- **Staff can grade** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM ((submissions s
     JOIN assignments a ON ((a.id = s.assignment_id)))
     JOIN enrollments e ON ((e.course_id = a.course_id)))
  WHERE ((s.id = grades.submission_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Staff can insert grades** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((EXISTS ( SELECT 1
   FROM ((submissions s
     JOIN assignments a ON ((a.id = s.assignment_id)))
     JOIN enrollments e ON ((e.course_id = a.course_id)))
  WHERE ((s.id = grades.submission_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Staff see all grades** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM ((submissions s
     JOIN assignments a ON ((a.id = s.assignment_id)))
     JOIN enrollments e ON ((e.course_id = a.course_id)))
  WHERE ((s.id = grades.submission_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Students see released grades** [SELECT] roles=(public) PERMISSIVE USING (((released = true) AND (EXISTS ( SELECT 1
   FROM submissions
  WHERE ((submissions.id = grades.submission_id) AND (submissions.user_id = auth.uid()))))))


### `public.group_members`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|group_id|"uuid"|NO|| |
|user_id|"uuid"|NO|| |
|joined_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "group_id"  public.course_groups("id")  (constraint `group_members_group_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `group_members_user_id_fkey`)

**Policies (RLS):**

- **group_members: enrolled select** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM course_groups cg
  WHERE ((cg.id = group_members.group_id) AND is_enrolled_in_course(cg.course_id)))))
- **group_members: staff manage** [ALL] roles=(public) PERMISSIVE USING (is_instructor_for_group(group_id))


### `public.group_sets`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|NO|| |
|name|"text"|NO|| |
|description|"text"|YES|| |
|created_by|"uuid"|YES|| |
|created_at|"timestamp with time zone"|NO|now()| |
|updated_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `group_sets_course_id_fkey`)
- "created_by"  public.profiles("id")  (constraint `group_sets_created_by_fkey`)

**Policies (RLS):**

- **group_sets: enrolled select** [SELECT] roles=(public) PERMISSIVE USING (is_enrolled_in_course(course_id))
- **group_sets: staff manage** [ALL] roles=(public) PERMISSIVE USING (is_instructor_in_course(course_id))


### `public.invites`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|email|"text"|NO|| |
|role|enrollment_role|NO|'student'::enrollment_role| |
|status|invite_status|YES|'pending'::invite_status| |
|invited_by|"uuid"|YES|| |
|created_at|"timestamp with time zone"|YES|now()| |
|accepted_at|"timestamp with time zone"|YES|| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `invites_course_id_fkey`)
- "invited_by"  public.profiles("id")  (constraint `invites_invited_by_fkey`)

**Policies (RLS):**

- **Staff manage invites** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = invites.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Staff see course invites** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = invites.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **invites: own email delete** [DELETE] roles=(public) PERMISSIVE USING ((email = auth.email()))
- **invites: own email select** [SELECT] roles=(public) PERMISSIVE USING ((email = auth.email()))
- **invites: superadmin delete** [DELETE] roles=(public) PERMISSIVE USING ((course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids)))
- **invites: superadmin insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids)))
- **invites: superadmin select** [SELECT] roles=(public) PERMISSIVE USING ((course_id IN ( SELECT get_superadmin_course_ids() AS get_superadmin_course_ids)))


### `public.messages`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|conversation_id|"uuid"|NO|| |
|sender_id|"uuid"|NO|| |
|content|"text"|NO|| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "conversation_id"  public.conversations("id")  (constraint `messages_conversation_id_fkey`)
- "sender_id"  public.profiles("id")  (constraint `messages_sender_id_fkey`)

**Policies (RLS):**

- **messages: participant insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (((sender_id = auth.uid()) AND is_conversation_participant(conversation_id)))
- **messages: participant select** [SELECT] roles=(public) PERMISSIVE USING (is_conversation_participant(conversation_id))


### `public.module_items`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|module_id|"uuid"|YES|| |
|type|module_item_type|NO|| |
|ref_id|"uuid"|YES|| |
|title|"text"|YES|| |
|url|"text"|YES|| |
|position|"integer"|YES|0| |
|updated_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "module_id"  public.modules("id")  (constraint `module_items_module_id_fkey`)

**Policies (RLS):**

- **See module items** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM modules m
  WHERE ((m.id = module_items.module_id) AND (EXISTS ( SELECT 1
           FROM enrollments
          WHERE ((enrollments.course_id = m.course_id) AND (enrollments.user_id = auth.uid()))))))))
- **Staff manage module items** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (modules m
     JOIN enrollments e ON ((e.course_id = m.course_id)))
  WHERE ((m.id = module_items.module_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.modules`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|name|"text"|NO|| |
|position|"integer"|YES|0| |
|created_at|"timestamp with time zone"|YES|now()| |
|hidden|"boolean"|YES|false| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `modules_course_id_fkey`)

**Policies (RLS):**

- **Enrolled see modules** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = modules.course_id) AND (enrollments.user_id = auth.uid())))))
- **Staff manage modules** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = modules.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.notification_preferences`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|user_id|"uuid"|NO|| |
|grade_released|"boolean"|NO|true| |
|assignment_due|"boolean"|NO|true| |
|announcement|"boolean"|NO|true| |
|submission_received|"boolean"|NO|true| |
|quiz_available|"boolean"|NO|true| |
|message_received|"boolean"|NO|true| |
|group_created|"boolean"|NO|true| |
|due_date_reminder|"boolean"|NO|true| |
|reminder_hours_before|"integer"|NO|24| |

**Foreign keys (outgoing):**

- "user_id"  public.profiles("id")  (constraint `notification_preferences_user_id_fkey`)

**Policies (RLS):**

- **notification_preferences: own insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((user_id = auth.uid()))
- **notification_preferences: own select** [SELECT] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))
- **notification_preferences: own update** [UPDATE] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))


### `public.notifications`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|user_id|"uuid"|NO|| |
|course_id|"uuid"|YES|| |
|type|notification_type|NO|| |
|title|"text"|NO|| |
|body|"text"|YES|| |
|link|"text"|YES|| |
|ref_id|"uuid"|YES|| |
|is_read|"boolean"|NO|false| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `notifications_course_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `notifications_user_id_fkey`)

**Policies (RLS):**

- **notifications: insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (((user_id = auth.uid()) OR ((course_id IS NOT NULL) AND is_enrolled_in_course(course_id) AND user_is_enrolled_in_course(user_id, course_id))))
- **notifications: own delete** [DELETE] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))
- **notifications: own select** [SELECT] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))
- **notifications: own update** [UPDATE] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))


### `public.org_invites`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|org_id|"uuid"|NO|| |
|email|"text"|NO|| |
|role|"text"|NO|'member'::text| |
|invited_by|"uuid"|YES|| |
|status|"text"|NO|'pending'::text| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "invited_by"  auth.users("id")  (constraint `org_invites_invited_by_fkey`)
- "org_id"  public.orgs("id")  (constraint `org_invites_org_id_fkey`)

**Policies (RLS):**

- **org_invites: own email delete** [DELETE] roles=(public) PERMISSIVE USING ((email = auth.email()))
- **org_invites: own email select** [SELECT] roles=(public) PERMISSIVE USING ((email = auth.email()))
- **org_invites: superadmin delete** [DELETE] roles=(public) PERMISSIVE USING (is_org_superadmin(org_id))
- **org_invites: superadmin insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (is_org_superadmin(org_id))
- **org_invites: superadmin select** [SELECT] roles=(public) PERMISSIVE USING (is_org_superadmin(org_id))
- **org_invites: superadmin update** [UPDATE] roles=(public) PERMISSIVE USING (is_org_superadmin(org_id)) WITH CHECK (is_org_superadmin(org_id))


### `public.org_members`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|org_id|"uuid"|NO|| |
|user_id|"uuid"|NO|| |
|role|org_member_role|NO|'member'::org_member_role| |
|created_at|"timestamp with time zone"|NO|now()| |
|updated_at|"timestamp with time zone"|NO|now()| |
|created_by|"uuid"|YES|| |
|sourced_id|"text"|YES|(id)::text| |
|oneroster_status|"text"|NO|'active'::text| |

**Foreign keys (outgoing):**

- "created_by"  public.profiles("id")  (constraint `org_members_created_by_fkey`)
- "org_id"  public.orgs("id")  (constraint `org_members_org_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `org_members_user_id_fkey`)

**Policies (RLS):**

- **org_members: self-insert via pending invite** [INSERT] roles=(public) PERMISSIVE WITH CHECK (((user_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM org_invites oi
  WHERE ((oi.org_id = org_members.org_id) AND (oi.email = auth.email()) AND (oi.status = 'pending'::text))))))
- **org_members: superadmin full access delete** [DELETE] roles=(public) PERMISSIVE USING (is_org_superadmin(org_id))
- **org_members: superadmin full access insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK (is_org_superadmin(org_id))
- **org_members: superadmin full access select** [SELECT] roles=(public) PERMISSIVE USING (is_org_superadmin(org_id))
- **org_members: superadmin full access update** [UPDATE] roles=(public) PERMISSIVE USING (is_org_superadmin(org_id))
- **org_members: users see own membership** [SELECT] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))


### `public.orgs`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|sourced_id|"text"|YES|(id)::text| |
|name|"text"|NO|| |
|type|"text"|NO|'school'::text| |
|identifier|"text"|YES|| |
|parent_id|"uuid"|YES|| |
|status|"text"|NO|'active'::text| |
|updated_at|"timestamp with time zone"|NO|now()| |
|numeric_id|"integer"|YES|nextval('orgs_numeric_id_seq'::regclass)| |

**Foreign keys (outgoing):**

- "parent_id"  public.orgs("id")  (constraint `orgs_parent_id_fkey`)


### `public.profiles`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|| |
|email|"text"|NO|| |
|name|"text"|NO|| |
|avatar|"text"|YES|| |
|created_at|"timestamp with time zone"|YES|now()| |
|updated_at|"timestamp with time zone"|YES|now()| |
|gemini_key|"text"|YES|| |
|sourced_id|"text"|YES|(id)::text| |
|given_name|"text"|YES|| |
|family_name|"text"|YES|| |
|oneroster_status|"text"|NO|'active'::text| |
|date_last_modified|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "id"  auth.users("id")  (constraint `profiles_id_fkey`)

**Policies (RLS):**

- **Users can update own profile** [UPDATE] roles=(public) PERMISSIVE USING ((auth.uid() = id))
- **profiles: course peers read** [SELECT] roles=(public) PERMISSIVE USING (shares_course_with(id))
- **profiles: org superadmin can read all** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM get_superadmin_org_ids() get_superadmin_org_ids(get_superadmin_org_ids))))
- **profiles: own full read** [SELECT] roles=(public) PERMISSIVE USING ((auth.uid() = id))
- **profiles: own insert** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((auth.uid() = id))
- **profiles: own update** [UPDATE] roles=(public) PERMISSIVE USING ((auth.uid() = id)) WITH CHECK ((auth.uid() = id))


### `public.question_banks`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|name|"text"|NO|| |
|created_at|"timestamp with time zone"|YES|now()| |
|description|"text"|YES|| |
|default_points_per_question|numeric(5,2)|YES|1| |
|randomize|"boolean"|YES|false| |
|created_by|"uuid"|YES|| |
|questions|"jsonb"|YES|'[]'::jsonb| |
|updated_at|"timestamp with time zone"|YES|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `question_banks_course_id_fkey`)
- "created_by"  public.profiles("id")  (constraint `question_banks_created_by_fkey`)

**Policies (RLS):**

- **Enrolled see question banks** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = question_banks.course_id) AND (enrollments.user_id = auth.uid())))))
- **Staff manage question banks** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = question_banks.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.quiz_questions`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|quiz_id|"uuid"|YES|| |
|type|question_type|NO|| |
|prompt|"text"|NO|| |
|options|"jsonb"|YES|| |
|correct_answer|"jsonb"|YES|| |
|points|"integer"|YES|1| |
|position|"integer"|YES|0| |

**Foreign keys (outgoing):**

- "quiz_id"  public.quizzes("id")  (constraint `quiz_questions_quiz_id_fkey`)

**Policies (RLS):**

- **See quiz questions** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM quizzes q
  WHERE ((q.id = quiz_questions.quiz_id) AND (((q.status = 'published'::content_status) AND (EXISTS ( SELECT 1
           FROM enrollments
          WHERE ((enrollments.course_id = q.course_id) AND (enrollments.user_id = auth.uid()))))) OR (EXISTS ( SELECT 1
           FROM enrollments
          WHERE ((enrollments.course_id = q.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))))))


### `public.quiz_submissions`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|quiz_id|"uuid"|YES|| |
|user_id|"uuid"|YES|| |
|answers|"jsonb"|YES|| |
|score|numeric(5,2)|YES|| |
|started_at|"timestamp with time zone"|YES|now()| |
|submitted_at|"timestamp with time zone"|YES|| |
|attempt_number|"integer"|YES|1| |
|assignment_id|"uuid"|YES|| |
|auto_score|numeric(5,2)|YES|| |
|graded|"boolean"|NO|false| |
|updated_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "assignment_id"  public.assignments("id")  (constraint `quiz_submissions_assignment_id_fkey`)
- "quiz_id"  public.quizzes("id")  (constraint `quiz_submissions_quiz_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `quiz_submissions_user_id_fkey`)

**Policies (RLS):**

- **Staff see quiz submissions** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (quizzes q
     JOIN enrollments e ON ((e.course_id = q.course_id)))
  WHERE ((q.id = quiz_submissions.quiz_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Students can submit quiz** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((user_id = auth.uid()))
- **Students see own quiz submissions** [SELECT] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))


### `public.quiz_time_overrides`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|quiz_id|"uuid"|NO|| |
|user_id|"uuid"|NO|| |
|time_limit|"integer"|YES|| |
|created_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "quiz_id"  public.quizzes("id")  (constraint `quiz_time_overrides_quiz_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `quiz_time_overrides_user_id_fkey`)

**Policies (RLS):**

- **quiz_overrides_all** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (quizzes q
     JOIN enrollments e ON (((e.course_id = q.course_id) AND (e.user_id = auth.uid()))))
  WHERE ((q.id = quiz_time_overrides.quiz_id) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **quiz_overrides_select** [SELECT] roles=(public) PERMISSIVE USING (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM (quizzes q
     JOIN enrollments e ON (((e.course_id = q.course_id) AND (e.user_id = auth.uid()))))
  WHERE ((q.id = quiz_time_overrides.quiz_id) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))


### `public.quizzes`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|course_id|"uuid"|YES|| |
|title|"text"|NO|| |
|description|"text"|YES|| |
|status|content_status|YES|'draft'::content_status| |
|due_date|"timestamp with time zone"|YES|| |
|time_limit|"integer"|YES|| |
|attempts_allowed|"integer"|YES|1| |
|randomize_questions|"boolean"|YES|false| |
|question_pool_enabled|"boolean"|YES|false| |
|question_select_count|"integer"|YES|| |
|created_by|"uuid"|YES|| |
|created_at|"timestamp with time zone"|YES|now()| |
|updated_at|"timestamp with time zone"|YES|now()| |

**Foreign keys (outgoing):**

- "course_id"  public.courses("id")  (constraint `quizzes_course_id_fkey`)
- "created_by"  public.profiles("id")  (constraint `quizzes_created_by_fkey`)

**Policies (RLS):**

- **Enrolled see published quizzes** [SELECT] roles=(public) PERMISSIVE USING ((((status = 'published'::content_status) AND (EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = quizzes.course_id) AND (enrollments.user_id = auth.uid()))))) OR (EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = quizzes.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role])))))))
- **Staff manage quizzes** [ALL] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM enrollments
  WHERE ((enrollments.course_id = quizzes.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))


### `public.rubric_criteria`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|rubric_id|"uuid"|YES|| |
|name|"text"|NO|| |
|description|"text"|YES|| |
|points|"integer"|NO|| |
|position|"integer"|YES|0| |
|updated_at|"timestamp with time zone"|NO|now()| |

**Foreign keys (outgoing):**

- "rubric_id"  public.rubrics("id")  (constraint `rubric_criteria_rubric_id_fkey`)

**Policies (RLS):**

- **See rubric criteria** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (rubrics r
     JOIN assignments a ON ((a.id = r.assignment_id)))
  WHERE ((r.id = rubric_criteria.rubric_id) AND (EXISTS ( SELECT 1
           FROM enrollments
          WHERE ((enrollments.course_id = a.course_id) AND (enrollments.user_id = auth.uid()))))))))


### `public.rubrics`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|assignment_id|"uuid"|YES|| |
|created_at|"timestamp with time zone"|YES|now()| |

**Foreign keys (outgoing):**

- "assignment_id"  public.assignments("id")  (constraint `rubrics_assignment_id_fkey`)

**Policies (RLS):**

- **See rubrics** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM assignments a
  WHERE ((a.id = rubrics.assignment_id) AND (EXISTS ( SELECT 1
           FROM enrollments
          WHERE ((enrollments.course_id = a.course_id) AND (enrollments.user_id = auth.uid()))))))))


### `public.submissions`

|Column|Type|Nullable|Default|Notes|
|---|---|---|---|---|
|id|"uuid"|NO|gen_random_uuid()| |
|assignment_id|"uuid"|YES|| |
|user_id|"uuid"|YES|| |
|content|"text"|YES|| |
|file_name|"text"|YES|| |
|file_path|"text"|YES|| |
|submitted_at|"timestamp with time zone"|YES|now()| |
|updated_at|"timestamp with time zone"|NO|now()| |
|group_id|"uuid"|YES|| |

**Foreign keys (outgoing):**

- "assignment_id"  public.assignments("id")  (constraint `submissions_assignment_id_fkey`)
- "group_id"  public.course_groups("id")  (constraint `submissions_group_id_fkey`)
- "user_id"  public.profiles("id")  (constraint `submissions_user_id_fkey`)

**Policies (RLS):**

- **Staff can create manual submissions** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((EXISTS ( SELECT 1
   FROM (assignments a
     JOIN enrollments e ON ((e.course_id = a.course_id)))
  WHERE ((a.id = submissions.assignment_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Staff can update submissions in their courses** [UPDATE] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (assignments a
     JOIN enrollments e ON ((e.course_id = a.course_id)))
  WHERE ((a.id = submissions.assignment_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Staff see submissions** [SELECT] roles=(public) PERMISSIVE USING ((EXISTS ( SELECT 1
   FROM (assignments a
     JOIN enrollments e ON ((e.course_id = a.course_id)))
  WHERE ((a.id = submissions.assignment_id) AND (e.user_id = auth.uid()) AND (e.role = ANY (ARRAY['instructor'::enrollment_role, 'ta'::enrollment_role]))))))
- **Students can resubmit** [UPDATE] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))
- **Students can submit** [INSERT] roles=(public) PERMISSIVE WITH CHECK ((user_id = auth.uid()))
- **Students see own submissions** [SELECT] roles=(public) PERMISSIVE USING ((user_id = auth.uid()))


 |
